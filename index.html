<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="HEMS Logger">
  <meta name="theme-color" content="#0b0c10">
  <title>HEMS Fuel/Flight Logger</title>
  <style>
    :root { --bg:#0b0c10; --card:#15171c; --text:#e8eaed; --muted:#9aa0a6; --muted2:#c0c4ca; --accent:#40c057; --safe-bottom: env(safe-area-inset-bottom); --safe-top: env(safe-area-inset-top); }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Apple Color Emoji,Noto Color Emoji;color:var(--text);background:#0b0c10;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-text-size-adjust:100%;padding-top:calc(var(--safe-top,0) + 0px);}  
    .wrap{max-width:820px;margin:0 auto;padding:16px 16px 160px;}
    .title{font-size:22px;font-weight:700;margin:8px 0 2px}
    .sub{font-size:12px;color:var(--muted);margin-bottom:14px}
    .card{background:var(--card);border:1px solid #23262d;border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:480px){ .row{grid-template-columns:1fr; gap:12px} }
    label{font-size:12px;color:var(--muted);display:block;margin:8px 0 6px}
    input{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #2a2e36;background:#0e1014;color:var(--text);font-size:17px;-webkit-appearance:none;appearance:none}
    input[type=\"datetime-local\"],input[type=\"date\"]{color-scheme:dark}
    .btns{position:fixed;left:0;right:0;bottom:0;background:rgba(11,12,16,.92);backdrop-filter:blur(10px);display:flex;gap:12px;padding:14px; padding-bottom:calc(14px + var(--safe-bottom,0)); border-top:1px solid #23262d;flex-wrap:wrap;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}
    .btn{flex:1;padding:14px 16px;border-radius:14px;border:1px solid #2a2e36;background:#101319;color:var(--text);font-weight:700;cursor:pointer;touch-action:manipulation;-webkit-tap-highlight-color:transparent}
    .btn.primary{background:var(--accent);border-color:transparent;color:#07120a}
    .btn.ghost{background:transparent}
    .mini{font-size:12px;color:var(--muted)}
    pre.list{white-space:pre; overflow:auto; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size:13px; line-height:1.2; padding:10px; color:var(--muted2); text-align:left}
    #fatal{display:none; position:fixed; inset:auto 12px calc(80px + var(--safe-bottom,0)) 12px; background:#3b0f0f; color:#ffd3d3; border:1px solid #803232; padding:10px; border-radius:10px; font-size:12px; z-index:9999; white-space:pre-wrap}
  </style>
</head>
<body>
  <div class=\"wrap\">
    <div class=\"title\">HEMS Fuel/Flight Logger</div>\n    <div class=\"sub\">Order: +Added Fuel (L) → Start Fuel (kg) → Location → Take-off → Landing → End Fuel (kg)</div>\n\n    <div class=\"card\">\n      <div class=\"row\">\n        <div>\n          <label>Flight time (minutes)</label>\n          <input id=\"flightMins\" type=\"number\" step=\"1\" inputmode=\"numeric\" placeholder=\"e.g. 42\"/>\n        </div>\n        <div>\n          <label style=\"display:flex;align-items:center;justify-content:space-between;gap:8px\">\n            <span>Landing time (auto now, editable)</span>\n            <button id=\"nowBtn\" type=\"button\" class=\"btn\" style=\"flex:0 0 auto;padding:8px 10px;font-size:12px\">Update Now</button>\n          </label>\n          <input id=\"tLand\" type=\"datetime-local\"/>\n          <div class=\"mini\" id=\"timeStatus\"></div>\n        </div>\n      </div>\n\n      <div class=\"row\">\n        <div>\n          <label>Take-off time (calculated)</label>\n          <input id=\"tOff\" type=\"datetime-local\" readonly/>\n        </div>\n        <div>\n          <label>Location</label>\n          <div style=\"display:flex; gap:8px; flex-wrap:nowrap; align-items:center\">\n            <input id=\"loc\" type=\"text\" placeholder=\"SP123456 or EGBE\" style=\"flex:1; min-width:0\"/>\n            <button class=\"btn\" id=\"gpsBtn\" style=\"flex:0 0 auto; padding:10px 12px; white-space:nowrap\">GPS</button>\n          </div>\n          <div class=\"mini\" id=\"gpsStatus\"></div>\n        </div>\n      </div>\n\n      <div class=\"row\">\n        <div>\n          <label>Fuel added (L)</label>\n          <input id=\"fuelAdded\" type=\"number\" step=\"0.1\" inputmode=\"decimal\"/>\n        </div>\n        <div>\n          <label>Fuel start (kg)</label>\n          <input id=\"fuelStart\" type=\"number\" step=\"0.1\" inputmode=\"decimal\"/>\n        </div>\n      </div>\n      <div class=\"row\">\n        <div>\n          <label>Landing fuel (kg)</label>\n          <input id=\"fuelEnd\" type=\"number\" step=\"0.1\" inputmode=\"decimal\"/>\n        </div>\n        <div>\n          <label>Date</label>\n          <input id=\"date\" type=\"date\"/>\n        </div>\n      </div>\n\n      <div id=\"summary\" style=\"margin-top:10px;font-size:13px;color:var(--muted)\"></div>\n    </div>\n\n    <div style=\"height:12px\"></div>\n\n    <div class=\"card\">\n      <div style=\"display:flex; gap:8px; align-items:center; justify-content:space-between; flex-wrap:wrap\">\n        <div class=\"mini\">Saved records</div>\n        <div style=\"display:flex; gap:8px;flex-wrap:wrap\">\n          <button class=\"btn ghost\" id=\"todayBtn\">Today</button>\n          <button class=\"btn ghost\" id=\"allBtn\">All</button>\n          <button class=\"btn\" id=\"exportBtn\">Export CSV</button>\n          <button class=\"btn\" id=\"clearTodayBtn\" title=\"Delete all of today's records\">Clear Today</button>\n        </div>\n      </div>\n      <pre class=\"list\" id=\"list\"></pre>\n    </div>\n  </div>\n\n  <div class=\"btns\">\n    <button class=\"btn\" id=\"installBtn\" title=\"Install the app\">Install</button>\n    <button class=\"btn primary\" id=\"saveBtn\">Save record</button>\n  </div>\n\n  <div id=\"fatal\"></div>\n\n  <script>\n    function showFatal(err){\n      try{\n        const el = document.getElementById('fatal');\n        el.style.display='block';\n        const msg = (err && (err.stack || err.message || String(err))) || 'Unknown error';\n        el.textContent = 'App error:\\n' + msg + '\\n(You can screenshot this and share.)';\n        console.error('[HEMS] fatal', err);\n      }catch(e){}\n    }\n    window.addEventListener('error', (e)=>{ showFatal(e.error || e.message); });\n    window.addEventListener('unhandledrejection', (e)=>{ showFatal(e.reason || e); });\n\n    (function(){\n      if(!('crypto' in window)) window.crypto = {};\n      if(!crypto.randomUUID){\n        crypto.randomUUID = function(){\n          return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c=>{\n            const r = Math.random()*16|0, v = c=='x'?r:(r&0x3|0x8);\n            return v.toString(16);\n          });\n        };\n      }\n      try{\n        const k='__hems__';\n        localStorage.setItem(k,'1'); localStorage.removeItem(k);\n        window.safeStorage = localStorage;\n      }catch(e){\n        window.safeStorage = { getItem(){return null}, setItem(){}, removeItem(){} };\n        console.warn('localStorage unavailable; running ephemeral.');\n      }\n    })();\n  </script>\n\n  <script>\n    const $ = (id)=>document.getElementById(id);\n    const LS_KEY = 'hems_min_logger_v6';\n    const DENSITY = 0.8;\n    let baseStartKg = 0;\n    let currentFilter='today';\n\n    const pad = (n)=>String(n).padStart(2,'0');\n    const toDT = (d)=>`${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;\n    const todayStr = ()=>{const d=new Date(); return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;};\n    const numFrom = (id)=>{ const el=$(id); const v=(el?.value||'').toString().trim().replace(',', '.'); const n=parseFloat(v); return Number.isFinite(n)?n:0; };\n\n    const Deg=Math.PI/180;\n    function asYYYYMMDD(input){\n      if(!input) return '';\n      if(/^\\d{4}-\\d{2}-\\d{2}$/.test(input)) return input;\n      const t = Date.parse(input);\n      if(Number.isNaN(t)) return '';\n      const d = new Date(t);\n      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;\n    }\n    function setDateValue(el, ymd){\n      if(!el || !ymd) return false;\n      el.value = ymd;\n      el.setAttribute('value', ymd);\n      try{ el.valueAsDate = new Date(ymd + 'T00:00:00'); }catch(e){}\n      if(el.value !== ymd){\n        const prevType = el.getAttribute('type') || el.type || 'date';\n        try{ el.setAttribute('type','text'); el.value = ymd; el.setAttribute('type', prevType); }catch(e){}\n      }\n      return el.value === ymd;\n    }\n    function syncDateToLanding(){\n      const landVal = $('tLand').value || $('tLand')._rawAssignedValue || '';\n      const raw = landVal && landVal.includes('T') ? landVal.split('T')[0] : landVal;\n      const ymd = asYYYYMMDD(raw);\n      if(!ymd) return;\n      setDateValue($('date'), ymd);\n    }\n\n    function minutesToHHMM(mins){ mins=Math.max(0,Math.floor(mins||0)); const h=Math.floor(mins/60), m=mins%60; return `${pad(h)}:${pad(m)}`; }\n    function diffHHMM(tOff,tLand){ if(!tOff||!tLand) return ''; const a=new Date(tOff).getTime(), b=new Date(tLand).getTime(); if(!isFinite(a)||!isFinite(b)) return ''; return minutesToHHMM(Math.max(0,Math.round((b-a)/60000))); }\n    function attachInstantCalc(){\n      const recalc = ()=>{\n        const mins = parseInt(numFrom('flightMins'),10);\n        const landVal = $('tLand').value || $('tLand')._rawAssignedValue || '';\n        if(mins>0 && landVal){\n          const takeoff = new Date(new Date(landVal).getTime() - mins*60000);\n          $('tOff').value = toDT(takeoff);\n        } else { $('tOff').value=''; }\n        if(landVal) syncDateToLanding();\n      };\n      ['flightMins','tLand'].forEach(id=>$(id).addEventListener('input', recalc));\n      ['tLand'].forEach(id=>$(id).addEventListener('change', recalc));\n      recalc();\n    }\n\n    function setLandingNow(){ const now=new Date(); $('tLand').value=toDT(now); syncDateToLanding(); $('flightMins').dispatchEvent(new Event('input')); const s=$('timeStatus'); if(s) s.textContent='Landing set to current time'; }\n\n    function populateFuelStart(){\n      const all = JSON.parse(safeStorage.getItem(LS_KEY) || '[]');\n      if(all.length>0){ const last=all[all.length-1]; if(last.fuelEnd){ baseStartKg=parseFloat(last.fuelEnd)||0; $('fuelStart').value=baseStartKg; return; } }\n      baseStartKg = numFrom('fuelStart'); $('fuelStart').value = baseStartKg ? baseStartKg.toFixed(1) : '';\n    }\n    function attachFuelLogic(){\n      const sync=()=>{ const L=numFrom('fuelAdded'); const kg=L*DENSITY; $('fuelStart').value=(baseStartKg+kg).toFixed(1); };\n      $('fuelAdded').addEventListener('input', sync);\n      $('fuelAdded').addEventListener('change', sync);\n      $('fuelStart').addEventListener('input', ()=>{ const L=numFrom('fuelAdded'); const kg=L*DENSITY; const v=numFrom('fuelStart'); if(Number.isFinite(v)) baseStartKg=v-kg; });\n    }\n\n    function save(){\n      const tOff=$('tOff').value, tLand=$('tLand').value || $('tLand')._rawAssignedValue || '';\n      let flightHM=diffHHMM(tOff,tLand); if(!flightHM){ const mins=parseInt(numFrom('flightMins'),10); if(mins>0) flightHM=minutesToHHMM(mins); }\n      const rec={ id:crypto.randomUUID(), date:$('date').value, fuelAdded:$('fuelAdded').value, fuelStart:$('fuelStart').value, loc:$('loc').value.trim().toUpperCase(), tOff, tLand, flightHM, fuelEnd:$('fuelEnd').value };\n      const all=JSON.parse(safeStorage.getItem(LS_KEY)||'[]'); all.push(rec); safeStorage.setItem(LS_KEY, JSON.stringify(all));\n      baseStartKg = parseFloat(rec.fuelEnd)||0; $('summary').textContent='Saved.'; setTimeout(()=>{$('summary').textContent='';},1200); renderList('today'); clearForNext();\n    }\n    function clearForNext(){ setTodayFields(); $('tOff').value=''; $('fuelAdded').value=''; $('fuelEnd').value=''; $('loc').value=''; $('flightMins').value=''; $('fuelStart').value=Number.isFinite(baseStartKg)?baseStartKg.toFixed(1):''; $('fuelAdded').dispatchEvent(new Event('input')); }\n    function loadAll(){ try{return JSON.parse(safeStorage.getItem(LS_KEY))||[]}catch(e){return[]} }\n    function renderList(filter){ if(filter) currentFilter=filter; const el=$('list'); el.textContent=''; const rows=loadAll(); const visible=rows.filter(r=> currentFilter==='all'?true:(r.date===todayStr())); if(!visible.length){ el.textContent='No records'; return; }\n      const tOnly=s=>s?s.split('T')[1]?.slice(0,5):'—'; const lines=[]; lines.push('+ADDED(L) | START(kg) | LOC      | TOFF | LAND | TIME  | END(kg)'); lines.push('-----------+-----------+----------+------+------ +-------+--------');\n      for(const r of visible){ const hm=r.flightHM||diffHHMM(r.tOff,r.tLand)||'00:00'; const line=[ (r.fuelAdded||'—').toString().padStart(9,' '), (r.fuelStart||'—').toString().padStart(9,' '), (r.loc||'—').toString().padEnd(8,' '), tOnly(r.tOff).padEnd(5,' '), tOnly(r.tLand).padEnd(5,' '), (hm||'00:00').toString().padEnd(5,' '), (r.fuelEnd||'—').toString().padStart(7,' ') ].join(' | '); lines.push(line);} el.textContent=lines.join('\\n'); }\n\n    function exportCSV(){ const rows=loadAll(); const visible=rows.filter(r=>currentFilter==='all'?true:(r.date===todayStr())); if(!visible.length){ alert('No records to export.'); return; } const headers=['date','fuelAdded','fuelStart','loc','tOff','tLand','flightTime','fuelEnd']; const csv=[headers.join(',')].concat(visible.map(r=>{ const obj={ date:r.date||'', fuelAdded:r.fuelAdded||'', fuelStart:r.fuelStart||'', loc:r.loc||'', tOff:(r.tOff||'').split('T')[1]?.slice(0,5)||'', tLand:(r.tLand||'').split('T')[1]?.slice(0,5)||'', flightTime:r.flightHM||diffHHMM(r.tOff,r.tLand)||'', fuelEnd:r.fuelEnd||'' }; return headers.map(h=>{ const s=String(obj[h]??''); return /[\",\\n]/.test(s)?'\"'+s.replace(/\"/g,'\"\"')+'\"':s; }).join(','); })).join('\\n'); const blob=new Blob([csv],{type:'text/csv'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`hems-records-${currentFilter==='all'?'all':todayStr()}.csv`; document.body.appendChild(a); a.click(); a.remove(); }\n\n    function helmertWGS84toOSGB36(lat, lon){\n      const a1=6378137.0, b1=6356752.314245, e2_1=(a1*a1-b1*b1)/(a1*a1);\n      const phi=lat, lam=lon; const nu=a1/Math.sqrt(1-e2_1*Math.sin(phi)**2);\n      const x=nu*Math.cos(phi)*Math.cos(lam);\n      const y=nu*Math.cos(phi)*Math.sin(lam);\n      const z=(nu*(1-e2_1))*Math.sin(phi);\n      const tx=-446.448, ty=125.157, tz=-542.06; const s=20.4894e-6;\n      const rx=(-0.1502/3600)*Math.PI/180, ry=(-0.2470/3600)*Math.PI/180, rz=(-0.8421/3600)*Math.PI/180;\n      const x2=tx + (1+s)*x + (-rz)*y + (ry)*z;\n      const y2=ty + (rz)*x + (1+s)*y + (-rx)*z;\n      const z2=tz + (-ry)*x + (rx)*y + (1+s)*z;\n      const a2=6377563.396, b2=6356256.909, e2_2=(a2*a2-b2*b2)/(a2*a2);\n      const p=Math.hypot(x2,y2);\n      let phi2=Math.atan2(z2, p*(1-e2_2)); let phi2prev=0; const tol=1e-12; let nu2=0;\n      while(Math.abs(phi2-phi2prev)>tol){ phi2prev=phi2; nu2=a2/Math.sqrt(1-e2_2*Math.sin(phi2)**2); phi2=Math.atan2(z2+e2_2*nu2*Math.sin(phi2), p); }\n      const lam2=Math.atan2(y2,x2); return {lat:phi2, lon:lam2};\n    }\n    function projectToBNG(phi, lam){\n      const a=6377563.396, b=6356256.909, F0=0.9996012717; const lat0=49*Math.PI/180, lon0=-2*Math.PI/180, N0=-100000, E0=400000; const e2=(a*a-b*b)/(a*a), n=(a-b)/(a+b); const nu=a*F0/Math.sqrt(1-e2*Math.sin(phi)**2); const rho=a*F0*(1-e2)/Math.pow(1-e2*Math.sin(phi)**2,1.5); const eta2=nu/rho-1; const M=b*F0*( (1+n+(5/4)*n**2+(5/4)*n**3)*(phi-lat0) - (3*n+3*n**2+(21/8)*n**3)*Math.sin(phi-lat0)*Math.cos(phi+lat0) + ((15/8)*n**2+(15/8)*n**3)*Math.sin(2*(phi-lat0))*Math.cos(2*(phi+lat0)) - (35/24)*n**3*Math.sin(3*(phi-lat0))*Math.cos(3*(phi+lat0)) ); const dl=lam-lon0; const cosφ=Math.cos(phi), tanφ=Math.tan(phi); const E=E0 + nu*( dl*cosφ + (dl**3*cosφ**3/6)*(1-tanφ**2+eta2) + (dl**5*cosφ**5/120)*(5-18*tanφ**2+tanφ**4+14*eta2-58*tanφ**2*eta2) ); const N=N0 + M + nu*tanφ*( (dl**2*cosφ**2/2) + (dl**4*cosφ**4/24)*(5-tanφ**2+9*eta2) + (dl**6*cosφ**6/720)*(61-58*tanφ**2+tanφ**4) ); return {E,N};\n    }\n    function enToGridRef(E,N,digits=6){ if(E<0||E>700000||N<0||N>1300000) return ''; const e100k=Math.floor(E/100000), n100k=Math.floor(N/100000); const l1=(19-n100k)-((19-n100k)%5)+Math.floor((e100k+10)/5); const l2=((19-n100k)*5)%25 + (e100k%5); const letters='ABCDEFGHJKLMNOPQRSTUVWXYZ'; const pair=letters[l1]+letters[l2]; let e=Math.floor((E%100000)), n2=Math.floor((N%100000)); const scale=5-digits/2; e=Math.floor(e/10**scale); n2=Math.floor(n2/10**scale); const pad2=(x,len)=>String(x).padStart(len,'0'); const fig=digits/2; return `${pair}${pad2(e,fig)}${pad2(n2,fig)}`; }\n    function latLonToOSGrid(lat, lon){ const phi=lat*Math.PI/180, lam=lon*Math.PI/180; const os=helmertWGS84toOSGB36(phi,lam); const en=projectToBNG(os.lat, os.lon); const gr=enToGridRef(en.E,en.N,6); return gr||`${lat.toFixed(5)},${lon.toFixed(5)}`; }\n\n    function setupGPS(){ const btn=$('gpsBtn'); if(!btn) return; btn.addEventListener('click', ()=>{ const status=$('gpsStatus'); if(!navigator.geolocation){ if(status) status.textContent='GPS not available'; return; } status.textContent='Requesting position…'; navigator.geolocation.getCurrentPosition( pos=>{ const {latitude:lat, longitude:lon}=pos.coords; const grid=latLonToOSGrid(lat, lon); $('loc').value = grid; if(status) status.textContent= grid.includes(',')? 'Outside GB (lat,lon used)':'Location set (OS grid)'; }, err=>{ if(status) status.textContent='GPS error: '+err.message; }, {enableHighAccuracy:true, timeout:15000, maximumAge:0}); }, {passive:true}); }\n\n    function setTodayFields(){ const now=new Date(); $('tLand').value=toDT(now); syncDateToLanding(); const s=$('timeStatus'); if(s) s.textContent='Landing pre-filled to now'; }\n\n    function exportCSV(){ const rows=loadAll(); const visible=rows.filter(r=>currentFilter==='all'?true:(r.date===todayStr())); if(!visible.length){ alert('No records to export.'); return; } const headers=['date','fuelAdded','fuelStart','loc','tOff','tLand','flightTime','fuelEnd']; const csv=[headers.join(',')].concat(visible.map(r=>{ const obj={ date:r.date||'', fuelAdded:r.fuelAdded||'', fuelStart:r.fuelStart||'', loc:r.loc||'', tOff:(r.tOff||'').split('T')[1]?.slice(0,5)||'', tLand:(r.tLand||'').split('T')[1]?.slice(0,5)||'', flightTime:r.flightHM||diffHHMM(r.tOff,r.tLand)||'', fuelEnd:r.fuelEnd||'' }; return headers.map(h=>{ const s=String(obj[h]??''); return /[\",\\n]/.test(s)?'\"'+s.replace(/\"/g,'\"\"')+'\"':s; }).join(','); })).join('\\n'); const blob=new Blob([csv],{type:'text/csv'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`hems-records-${currentFilter==='all'?'all':todayStr()}.csv`; document.body.appendChild(a); a.click(); a.remove(); }\n\n    function init(){\n      try{\n        setTodayFields(); attachInstantCalc(); populateFuelStart(); attachFuelLogic(); setupGPS(); renderList('today');\n        $('exportBtn').addEventListener('click', exportCSV);\n        $('saveBtn').addEventListener('click', save);\n        $('todayBtn').addEventListener('click', ()=>renderList('today'));\n        $('allBtn').addEventListener('click', ()=>renderList('all'));\n        $('clearTodayBtn').addEventListener('click', ()=>{ if(!confirm(\"Delete ALL of today's records? This cannot be undone.\")) return; const all = loadAll(); const remaining = all.filter(r=> r.date !== todayStr()); safeStorage.setItem(LS_KEY, JSON.stringify(remaining)); if(remaining.length){ const last = remaining[remaining.length-1]; baseStartKg = parseFloat(last.fuelEnd)||0; if(Number.isFinite(baseStartKg)) $('fuelStart').value = baseStartKg.toFixed(1); } renderList(currentFilter); $('summary').textContent = \"Today's records cleared.\"; setTimeout(()=>{$('summary').textContent='';},1500); });\n        const nowButton = $('nowBtn'); if(nowButton) nowButton.addEventListener('click', setLandingNow, {passive:true});\n        document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) setTodayFields(); }, {passive:true});\n        setInterval(()=>{ const d=$('date'); if(d && d.value !== todayStr()) setTodayFields(); }, 60000);\n        setTimeout(()=>{ const d=$('date'); if(!d.value) setTodayFields(); if(!$('tLand').value) setTodayFields(); }, 250);\n        // Silent self-tests (console errors only on failure)\n        (function(){ let failed=0; const assert=(c,n)=>{ if(!c){ failed++; console.error('✗ '+n);} }; assert(minutesToHHMM(125)=='02:05','minutesToHHMM'); $('tLand').value='2025-10-20'; syncDateToLanding(); assert($('date').value==='2025-10-20','date-only landing'); })();\n      }catch(e){ showFatal(e); }\n    }\n    if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', init); else init();\n  </script>\n</body>\n</html>\n